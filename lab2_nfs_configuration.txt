RHCE RH254 HANDS-ON LAB: NETWORK TIME PROTOCOL (NTP) CONFIGURATION
================================================================

LAB OBJECTIVE:
Configure NTP server and client to synchronize system time across network

PREREQUISITES:
- RHEL 7/8 system with root access
- Network connectivity
- Basic understanding of systemd services

LAB SCENARIO:
You are tasked to configure server1 as NTP server and server2 as NTP client.
Both systems should maintain accurate time synchronization.

EQUIPMENT NEEDED:
- 2 RHEL systems (server1: 192.168.1.10, server2: 192.168.1.20)
- Internet connectivity for external time sources

LAB TASKS:

PART A: CONFIGURE NTP SERVER (server1)
---------------------------------------

1. Install NTP service:
   # yum install chrony -y
   # systemctl enable chronyd

2. Configure NTP sxerver (/etc/ntp.conf):
   #install yum 
   # yum install vim -y
   # cp /etc/chrony.conf /etc/chrony.conf.backup
   # vim /etc/chrony.conf
   
   Add/modify these lines:
   server 0.rhel.pool.ntp.org iburst
   server 1.rhel.pool.ntp.org iburst
   server 2.rhel.pool.ntp.org iburst
   
   # Allow local network to sync
   allow 20.192.226.212  (Use server 2 ip)
   local stratum 10

3. Configure firewall:
 
   # install firewall 
   # yum install firewalld -y
   # systemctl enable --now firewalld
   
   # firewall-cmd --permanent --add-service=ntp
   # firewall-cmd --reload

4. Start and verify NTP service:
   # systemctl start chronyd
   # systemctl status chronyd
   # chronyc sources -v


PART B: CONFIGURE NTP CLIENT (server2)
---------------------------------------

1. Install NTP client:
   # yum install chrony -y
   # systemctl enable chronyd

2. Configure NTP client (/etc/ntp.conf):
   #install yum 
   # yum install vim -y
   
   # vim /etc/chrony.conf
   
   Replace server lines with:
   server 20.192.222.115 iburst prefer  (User Server 1 Ip )
   server 0.rhel.pool.ntp.org iburst

4. Configure firewall:
 
   # install firewall 
   # yum install firewalld
   # systemctl enable --now firewalld
   
   # firewall-cmd --permanent --add-service=ntp
   # firewall-cmd --reload


5. Start NTP service:
   # systemctl start chronyd
   # systemctl status chronyd

6. Force time synchronization:
   # chronyc makestep


PART C: VERIFICATION AND TESTING
---------------------------------

1. Check NTP synchronization status :  (Run this in both server )
   # chronyc sources -v
   # chronyc tracking
   # timedatectl status

2. Monitor NTP peers:
   # watch -n 5 chronyc sources -v

3. Test time drift correction:   (Run this in server 2)
   # date -s "2 hours ago"
   # systemctl restart chronyd
   # watch -n 10 'date'

4. Check NTP logs:
   # journalctl -u chronyd -f

TROUBLESHOOTING COMMANDS:
-------------------------
# chronyc sources -v
# chronyc tracking
# chronyc activity
# chronyc ntpdata

EXPECTED RESULTS:
-----------------
- server1 shows external NTP servers as sources
- server2 shows server1 as preferred source
- Both systems maintain synchronized time
- NTP service starts automatically on boot

VALIDATION CHECKLIST:
---------------------
□ NTP service running on both systems  working 
□ Firewall allows NTP traffic          working
□ Client successfully syncs with server   not working 
□ Time remains synchronized over time     not working 
□ Services start automatically on boot    working 

CLEANUP:
--------
# systemctl stop chronyd
# systemctl disable chronyd
# firewall-cmd --permanent --remove-service=ntp
# firewall-cmd --reload
