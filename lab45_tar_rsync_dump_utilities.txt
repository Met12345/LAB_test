RHCE RH254 HANDS-ON LAB: TAR, RSYNC, AND DUMP UTILITIES
======================================================

LAB OBJECTIVE:
Master advanced usage of tar, rsync, and dump utilities for comprehensive backup and synchronization operations in enterprise environments

PREREQUISITES:
- RHEL 8/9 system with root access
- Understanding of file systems and backup concepts
- Basic knowledge of compression and archiving
- Familiarity with network file operations

LAB SCENARIO:
Implement enterprise backup and synchronization solutions using tar for archiving, rsync for efficient file synchronization, and dump utilities for filesystem-level backups.

EQUIPMENT NEEDED:
- RHEL system (192.168.1.20)
- Remote server for rsync operations (192.168.1.10)
- Test data and filesystems
- Network connectivity for remote operations

LAB TASKS:

PART A: ADVANCED TAR OPERATIONS
-------------------------------

1. Create test data structure:
   # mkdir -p /test-data/{documents,images,logs,config}
   # echo "Document 1" > /test-data/documents/doc1.txt
   # echo "Document 2" > /test-data/documents/doc2.txt
   # echo "Config file" > /test-data/config/app.conf
   # echo "Log entry" > /test-data/logs/app.log
   # dd if=/dev/zero of=/test-data/images/image1.dat bs=1M count=10
   # dd if=/dev/zero of=/test-data/images/image2.dat bs=1M count=5

2. Basic tar archiving operations:
   # tar -cvf /backup/basic-archive.tar /test-data
   # tar -czvf /backup/compressed-archive.tar.gz /test-data
   # tar -cjvf /backup/bzip2-archive.tar.bz2 /test-data
   # tar -cJvf /backup/xz-archive.tar.xz /test-data

3. Create advanced tar script:
   # vim /usr/local/bin/advanced-tar.sh
   
   #!/bin/bash
   SOURCE_DIR=$1
   ARCHIVE_NAME=$2
   COMPRESSION=${3:-"gzip"}
   
   if [ $# -lt 2 ]; then
       echo "Usage: $0 <source_dir> <archive_name> [compression]"
       echo "Compression options: gzip, bzip2, xz, none"
       exit 1
   fi
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   BACKUP_DIR="/backup/tar-backups"
   mkdir -p $BACKUP_DIR
   
   case $COMPRESSION in
       "gzip")
           ARCHIVE_FILE="$BACKUP_DIR/${ARCHIVE_NAME}-${TIMESTAMP}.tar.gz"
           TAR_OPTIONS="-czf"
           ;;
       "bzip2")
           ARCHIVE_FILE="$BACKUP_DIR/${ARCHIVE_NAME}-${TIMESTAMP}.tar.bz2"
           TAR_OPTIONS="-cjf"
           ;;
       "xz")
           ARCHIVE_FILE="$BACKUP_DIR/${ARCHIVE_NAME}-${TIMESTAMP}.tar.xz"
           TAR_OPTIONS="-cJf"
           ;;
       "none")
           ARCHIVE_FILE="$BACKUP_DIR/${ARCHIVE_NAME}-${TIMESTAMP}.tar"
           TAR_OPTIONS="-cf"
           ;;
       *)
           echo "Invalid compression option: $COMPRESSION"
           exit 1
           ;;
   esac
   
   echo "Creating archive: $ARCHIVE_FILE"
   
   # Create exclude file
   EXCLUDE_FILE="/tmp/tar-exclude-$$"
   cat > $EXCLUDE_FILE << 'EOF'
   *.tmp
   *.log
   .cache/*
   .git/*
   node_modules/*
   EOF
   
   # Create archive with progress and exclude patterns
   tar $TAR_OPTIONS "$ARCHIVE_FILE" \
       --exclude-from="$EXCLUDE_FILE" \
       --verbose \
       --totals \
       --checkpoint=100 \
       --checkpoint-action=dot \
       "$SOURCE_DIR"
   
   if [ $? -eq 0 ]; then
       echo "Archive created successfully: $ARCHIVE_FILE"
       echo "Archive size: $(du -h "$ARCHIVE_FILE" | cut -f1)"
       
       # Create checksum
       sha256sum "$ARCHIVE_FILE" > "${ARCHIVE_FILE}.sha256"
       echo "Checksum created: ${ARCHIVE_FILE}.sha256"
   else
       echo "Archive creation failed"
       exit 1
   fi
   
   # Cleanup
   rm -f $EXCLUDE_FILE
   
   # chmod +x /usr/local/bin/advanced-tar.sh

4. Create incremental tar backup:
   # vim /usr/local/bin/incremental-tar.sh
   
   #!/bin/bash
   SOURCE_DIR=$1
   BACKUP_NAME=$2
   BACKUP_DIR="/backup/incremental-tar"
   SNAPSHOT_DIR="$BACKUP_DIR/snapshots"
   
   mkdir -p $BACKUP_DIR $SNAPSHOT_DIR
   
   if [ $# -lt 2 ]; then
       echo "Usage: $0 <source_dir> <backup_name>"
       exit 1
   fi
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   SNAPSHOT_FILE="$SNAPSHOT_DIR/${BACKUP_NAME}.snapshot"
   ARCHIVE_FILE="$BACKUP_DIR/${BACKUP_NAME}-incremental-${TIMESTAMP}.tar.gz"
   
   echo "Creating incremental backup: $ARCHIVE_FILE"
   
   # Create incremental backup using snapshot file
   tar -czf "$ARCHIVE_FILE" \
       --listed-incremental="$SNAPSHOT_FILE" \
       --verbose \
       "$SOURCE_DIR"
   
   if [ $? -eq 0 ]; then
       echo "Incremental backup completed: $ARCHIVE_FILE"
       echo "Snapshot file: $SNAPSHOT_FILE"
       echo "Archive size: $(du -h "$ARCHIVE_FILE" | cut -f1)"
   else
       echo "Incremental backup failed"
       exit 1
   fi
   
   # chmod +x /usr/local/bin/incremental-tar.sh
PART B: ADVANCED RSYNC OPERATIONS
----------------------------------

1. Install and configure rsync:
   # dnf install rsync -y
   # systemctl enable rsyncd
   # systemctl start rsyncd

2. Configure rsync daemon:
   # vim /etc/rsyncd.conf
   
   # Global settings
   uid = nobody
   gid = nobody
   use chroot = yes
   max connections = 4
   pid file = /var/run/rsyncd.pid
   log file = /var/log/rsyncd.log
   
   # Backup module
   [backup]
   path = /backup/rsync-backups
   comment = Backup directory
   read only = no
   list = yes
   auth users = backup
   secrets file = /etc/rsyncd.secrets
   
   # Data module
   [data]
   path = /test-data
   comment = Test data directory
   read only = yes
   list = yes

3. Create rsync authentication:
   # echo "backup:rsync123" > /etc/rsyncd.secrets
   # chmod 600 /etc/rsyncd.secrets
   # systemctl restart rsyncd

4. Create advanced rsync backup script:
   # vim /usr/local/bin/rsync-backup.sh
   
   #!/bin/bash
   SOURCE=$1
   DESTINATION=$2
   BACKUP_TYPE=${3:-"mirror"}
   
   if [ $# -lt 2 ]; then
       echo "Usage: $0 <source> <destination> [backup_type]"
       echo "Backup types: mirror, incremental, snapshot"
       exit 1
   fi
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/rsync-backup-$TIMESTAMP.log"
   
   # Common rsync options
   RSYNC_OPTS="-avz --progress --stats --human-readable"
   
   case $BACKUP_TYPE in
       "mirror")
           echo "Creating mirror backup from $SOURCE to $DESTINATION"
           rsync $RSYNC_OPTS \
                 --delete \
                 --delete-excluded \
                 "$SOURCE/" "$DESTINATION/" \
                 2>&1 | tee $LOG_FILE
           ;;
       "incremental")
           BACKUP_DIR="$DESTINATION/backup-$TIMESTAMP"
           LATEST_LINK="$DESTINATION/latest"
           
           echo "Creating incremental backup to $BACKUP_DIR"
           
           if [ -L "$LATEST_LINK" ]; then
               rsync $RSYNC_OPTS \
                     --link-dest="$LATEST_LINK" \
                     "$SOURCE/" "$BACKUP_DIR/" \
                     2>&1 | tee $LOG_FILE
           else
               rsync $RSYNC_OPTS \
                     "$SOURCE/" "$BACKUP_DIR/" \
                     2>&1 | tee $LOG_FILE
           fi
           
           # Update latest link
           rm -f "$LATEST_LINK"
           ln -s "$BACKUP_DIR" "$LATEST_LINK"
           ;;
       "snapshot")
           SNAPSHOT_DIR="$DESTINATION/snapshots/snapshot-$TIMESTAMP"
           mkdir -p "$SNAPSHOT_DIR"
           
           echo "Creating snapshot backup to $SNAPSHOT_DIR"
           rsync $RSYNC_OPTS \
                 --backup \
                 --backup-dir="$SNAPSHOT_DIR" \
                 "$SOURCE/" "$DESTINATION/current/" \
                 2>&1 | tee $LOG_FILE
           ;;
       *)
           echo "Invalid backup type: $BACKUP_TYPE"
           exit 1
           ;;
   esac
   
   if [ $? -eq 0 ]; then
       echo "Rsync backup completed successfully"
       echo "Log file: $LOG_FILE"
   else
       echo "Rsync backup failed"
       exit 1
   fi
   
   # chmod +x /usr/local/bin/rsync-backup.sh

5. Create rsync synchronization script:
   # vim /usr/local/bin/rsync-sync.sh
   
   #!/bin/bash
   SOURCE=$1
   DESTINATION=$2
   SYNC_MODE=${3:-"push"}
   
   if [ $# -lt 2 ]; then
       echo "Usage: $0 <source> <destination> [sync_mode]"
       echo "Sync modes: push, pull, bidirectional"
       exit 1
   fi
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/rsync-sync-$TIMESTAMP.log"
   
   # Rsync options for synchronization
   SYNC_OPTS="-avz --progress --stats --human-readable --update"
   
   echo "Starting rsync synchronization: $SYNC_MODE mode" | tee $LOG_FILE
   
   case $SYNC_MODE in
       "push")
           echo "Pushing changes from $SOURCE to $DESTINATION" | tee -a $LOG_FILE
           rsync $SYNC_OPTS "$SOURCE/" "$DESTINATION/" 2>&1 | tee -a $LOG_FILE
           ;;
       "pull")
           echo "Pulling changes from $DESTINATION to $SOURCE" | tee -a $LOG_FILE
           rsync $SYNC_OPTS "$DESTINATION/" "$SOURCE/" 2>&1 | tee -a $LOG_FILE
           ;;
       "bidirectional")
           echo "Bidirectional sync between $SOURCE and $DESTINATION" | tee -a $LOG_FILE
           
           # First sync: source to destination
           echo "Phase 1: Source to destination" | tee -a $LOG_FILE
           rsync $SYNC_OPTS "$SOURCE/" "$DESTINATION/" 2>&1 | tee -a $LOG_FILE
           
           # Second sync: destination to source (only newer files)
           echo "Phase 2: Destination to source (newer files only)" | tee -a $LOG_FILE
           rsync $SYNC_OPTS "$DESTINATION/" "$SOURCE/" 2>&1 | tee -a $LOG_FILE
           ;;
       *)
           echo "Invalid sync mode: $SYNC_MODE"
           exit 1
           ;;
   esac
   
   if [ $? -eq 0 ]; then
       echo "Rsync synchronization completed successfully" | tee -a $LOG_FILE
   else
       echo "Rsync synchronization failed" | tee -a $LOG_FILE
       exit 1
   fi
   
   # chmod +x /usr/local/bin/rsync-sync.sh

6. Create remote rsync backup script:
   # vim /usr/local/bin/rsync-remote-backup.sh
   
   #!/bin/bash
   SOURCE=$1
   REMOTE_HOST=$2
   REMOTE_PATH=$3
   SSH_KEY=${4:-"/root/.ssh/id_rsa"}
   
   if [ $# -lt 3 ]; then
       echo "Usage: $0 <source> <remote_host> <remote_path> [ssh_key]"
       exit 1
   fi
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/rsync-remote-$TIMESTAMP.log"
   
   echo "Starting remote rsync backup" | tee $LOG_FILE
   echo "Source: $SOURCE" | tee -a $LOG_FILE
   echo "Destination: $REMOTE_HOST:$REMOTE_PATH" | tee -a $LOG_FILE
   
   # Check SSH connectivity
   if ! ssh -i "$SSH_KEY" -o ConnectTimeout=10 "$REMOTE_HOST" "echo 'SSH connection test'" >/dev/null 2>&1; then
       echo "SSH connection to $REMOTE_HOST failed" | tee -a $LOG_FILE
       exit 1
   fi
   
   # Perform remote backup
   rsync -avz \
         --progress \
         --stats \
         --human-readable \
         --compress \
         --partial \
         --inplace \
         -e "ssh -i $SSH_KEY" \
         "$SOURCE/" \
         "$REMOTE_HOST:$REMOTE_PATH/" \
         2>&1 | tee -a $LOG_FILE
   
   if [ $? -eq 0 ]; then
       echo "Remote rsync backup completed successfully" | tee -a $LOG_FILE
   else
       echo "Remote rsync backup failed" | tee -a $LOG_FILE
       exit 1
   fi
   
   # chmod +x /usr/local/bin/rsync-remote-backup.sh

PART C: DUMP AND RESTORE UTILITIES
-----------------------------------

1. Install dump utilities:
   # dnf install dump -y

2. Create filesystem for dump testing:
   # dd if=/dev/zero of=/tmp/test-fs.img bs=1M count=100
   # mkfs.ext4 /tmp/test-fs.img
   # mkdir -p /mnt/test-fs
   # mount -o loop /tmp/test-fs.img /mnt/test-fs
   
   # Create test data on the filesystem
   # mkdir -p /mnt/test-fs/{dir1,dir2,dir3}
   # echo "Test file 1" > /mnt/test-fs/dir1/file1.txt
   # echo "Test file 2" > /mnt/test-fs/dir2/file2.txt
   # echo "Test file 3" > /mnt/test-fs/dir3/file3.txt

3. Create dump backup script:
   # vim /usr/local/bin/dump-backup.sh
   
   #!/bin/bash
   FILESYSTEM=$1
   DUMP_LEVEL=${2:-0}
   BACKUP_DIR="/backup/dump-backups"
   
   if [ -z "$FILESYSTEM" ]; then
       echo "Usage: $0 <filesystem> [dump_level]"
       echo "Example: $0 /dev/sda1 0"
       exit 1
   fi
   
   mkdir -p $BACKUP_DIR
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   DUMP_FILE="$BACKUP_DIR/dump-level${DUMP_LEVEL}-${TIMESTAMP}.dump"
   LOG_FILE="/var/log/dump-backup-$TIMESTAMP.log"
   
   echo "Starting dump backup of $FILESYSTEM (level $DUMP_LEVEL)" | tee $LOG_FILE
   
   # Perform dump backup
   dump -${DUMP_LEVEL}u -f "$DUMP_FILE" "$FILESYSTEM" 2>&1 | tee -a $LOG_FILE
   
   if [ $? -eq 0 ]; then
       echo "Dump backup completed successfully" | tee -a $LOG_FILE
       echo "Dump file: $DUMP_FILE" | tee -a $LOG_FILE
       echo "File size: $(du -h "$DUMP_FILE" | cut -f1)" | tee -a $LOG_FILE
       
       # Create checksum
       sha256sum "$DUMP_FILE" > "${DUMP_FILE}.sha256"
       echo "Checksum created: ${DUMP_FILE}.sha256" | tee -a $LOG_FILE
   else
       echo "Dump backup failed" | tee -a $LOG_FILE
       exit 1
   fi
   
   # chmod +x /usr/local/bin/dump-backup.sh

4. Create restore script:
   # vim /usr/local/bin/dump-restore.sh
   
   #!/bin/bash
   DUMP_FILE=$1
   RESTORE_DIR=$2
   RESTORE_MODE=${3:-"interactive"}
   
   if [ $# -lt 2 ]; then
       echo "Usage: $0 <dump_file> <restore_directory> [restore_mode]"
       echo "Restore modes: interactive, automatic, extract"
       exit 1
   fi
   
   if [ ! -f "$DUMP_FILE" ]; then
       echo "Dump file not found: $DUMP_FILE"
       exit 1
   fi
   
   mkdir -p "$RESTORE_DIR"
   cd "$RESTORE_DIR"
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/dump-restore-$TIMESTAMP.log"
   
   echo "Starting restore from $DUMP_FILE to $RESTORE_DIR" | tee $LOG_FILE
   
   case $RESTORE_MODE in
       "interactive")
           echo "Interactive restore mode" | tee -a $LOG_FILE
           restore -i -f "$DUMP_FILE" 2>&1 | tee -a $LOG_FILE
           ;;
       "automatic")
           echo "Automatic restore mode (all files)" | tee -a $LOG_FILE
           restore -r -f "$DUMP_FILE" 2>&1 | tee -a $LOG_FILE
           ;;
       "extract")
           echo "Extract mode (specific files)" | tee -a $LOG_FILE
           restore -x -f "$DUMP_FILE" 2>&1 | tee -a $LOG_FILE
           ;;
       *)
           echo "Invalid restore mode: $RESTORE_MODE"
           exit 1
           ;;
   esac
   
   if [ $? -eq 0 ]; then
       echo "Restore completed successfully" | tee -a $LOG_FILE
       echo "Restored files in: $RESTORE_DIR" | tee -a $LOG_FILE
   else
       echo "Restore failed" | tee -a $LOG_FILE
       exit 1
   fi
   
   # chmod +x /usr/local/bin/dump-restore.sh

5. Create incremental dump system:
   # vim /usr/local/bin/incremental-dump.sh
   
   #!/bin/bash
   FILESYSTEM=$1
   BACKUP_DIR="/backup/incremental-dump"
   DUMP_RECORD="/etc/dumpdates"
   
   if [ -z "$FILESYSTEM" ]; then
       echo "Usage: $0 <filesystem>"
       exit 1
   fi
   
   mkdir -p $BACKUP_DIR
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/incremental-dump-$TIMESTAMP.log"
   
   echo "Starting incremental dump system for $FILESYSTEM" | tee $LOG_FILE
   
   # Check last dump level
   if [ -f "$DUMP_RECORD" ]; then
       LAST_LEVEL=$(grep "$FILESYSTEM" "$DUMP_RECORD" | tail -1 | awk '{print $2}' || echo "-1")
   else
       LAST_LEVEL=-1
   fi
   
   # Determine next dump level
   if [ $LAST_LEVEL -eq -1 ]; then
       DUMP_LEVEL=0
       echo "No previous dumps found, performing level 0 (full) dump" | tee -a $LOG_FILE
   elif [ $LAST_LEVEL -eq 9 ]; then
       DUMP_LEVEL=0
       echo "Maximum dump level reached, performing level 0 (full) dump" | tee -a $LOG_FILE
   else
       DUMP_LEVEL=$((LAST_LEVEL + 1))
       echo "Performing level $DUMP_LEVEL incremental dump" | tee -a $LOG_FILE
   fi
   
   DUMP_FILE="$BACKUP_DIR/incremental-level${DUMP_LEVEL}-${TIMESTAMP}.dump"
   
   # Perform incremental dump
   dump -${DUMP_LEVEL}u -f "$DUMP_FILE" "$FILESYSTEM" 2>&1 | tee -a $LOG_FILE
   
   if [ $? -eq 0 ]; then
       echo "Incremental dump completed successfully" | tee -a $LOG_FILE
       echo "Dump level: $DUMP_LEVEL" | tee -a $LOG_FILE
       echo "Dump file: $DUMP_FILE" | tee -a $LOG_FILE
       echo "File size: $(du -h "$DUMP_FILE" | cut -f1)" | tee -a $LOG_FILE
   else
       echo "Incremental dump failed" | tee -a $LOG_FILE
       exit 1
   fi
   
   # chmod +x /usr/local/bin/incremental-dump.sh

PART D: UTILITY COMPARISON AND INTEGRATION
-------------------------------------------

1. Create backup utility comparison script:
   # vim /usr/local/bin/backup-utility-comparison.sh
   
   #!/bin/bash
   SOURCE_DIR="/test-data"
   BACKUP_BASE="/backup/comparison"
   
   mkdir -p $BACKUP_BASE/{tar,rsync,dump}
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   REPORT_FILE="/var/log/backup-comparison-$TIMESTAMP.log"
   
   echo "=== BACKUP UTILITY COMPARISON - $(date) ===" | tee $REPORT_FILE
   echo >> $REPORT_FILE
   
   # Test TAR backup
   echo "Testing TAR backup..." | tee -a $REPORT_FILE
   TAR_START=$(date +%s)
   tar -czf "$BACKUP_BASE/tar/test-backup-$TIMESTAMP.tar.gz" "$SOURCE_DIR" 2>/dev/null
   TAR_END=$(date +%s)
   TAR_TIME=$((TAR_END - TAR_START))
   TAR_SIZE=$(du -b "$BACKUP_BASE/tar/test-backup-$TIMESTAMP.tar.gz" | cut -f1)
   
   echo "TAR Results:" | tee -a $REPORT_FILE
   echo "  Time: ${TAR_TIME} seconds" | tee -a $REPORT_FILE
   echo "  Size: $(numfmt --to=iec $TAR_SIZE)" | tee -a $REPORT_FILE
   echo >> $REPORT_FILE
   
   # Test RSYNC backup
   echo "Testing RSYNC backup..." | tee -a $REPORT_FILE
   RSYNC_START=$(date +%s)
   rsync -a "$SOURCE_DIR/" "$BACKUP_BASE/rsync/" 2>/dev/null
   RSYNC_END=$(date +%s)
   RSYNC_TIME=$((RSYNC_END - RSYNC_START))
   RSYNC_SIZE=$(du -sb "$BACKUP_BASE/rsync" | cut -f1)
   
   echo "RSYNC Results:" | tee -a $REPORT_FILE
   echo "  Time: ${RSYNC_TIME} seconds" | tee -a $REPORT_FILE
   echo "  Size: $(numfmt --to=iec $RSYNC_SIZE)" | tee -a $REPORT_FILE
   echo >> $REPORT_FILE
   
   # Test incremental operations
   echo "Testing incremental operations..." | tee -a $REPORT_FILE
   
   # Add new file
   echo "New content" > "$SOURCE_DIR/new-file.txt"
   
   # TAR incremental
   TAR_INC_START=$(date +%s)
   tar -czf "$BACKUP_BASE/tar/incremental-$TIMESTAMP.tar.gz" \
       --newer-mtime="1 minute ago" "$SOURCE_DIR" 2>/dev/null
   TAR_INC_END=$(date +%s)
   TAR_INC_TIME=$((TAR_INC_END - TAR_INC_START))
   TAR_INC_SIZE=$(du -b "$BACKUP_BASE/tar/incremental-$TIMESTAMP.tar.gz" | cut -f1)
   
   # RSYNC incremental
   RSYNC_INC_START=$(date +%s)
   rsync -a --update "$SOURCE_DIR/" "$BACKUP_BASE/rsync/" 2>/dev/null
   RSYNC_INC_END=$(date +%s)
   RSYNC_INC_TIME=$((RSYNC_INC_END - RSYNC_INC_START))
   
   echo "Incremental Results:" | tee -a $REPORT_FILE
   echo "  TAR incremental time: ${TAR_INC_TIME} seconds" | tee -a $REPORT_FILE
   echo "  TAR incremental size: $(numfmt --to=iec $TAR_INC_SIZE)" | tee -a $REPORT_FILE
   echo "  RSYNC incremental time: ${RSYNC_INC_TIME} seconds" | tee -a $REPORT_FILE
   echo >> $REPORT_FILE
   
   # Summary
   echo "SUMMARY:" | tee -a $REPORT_FILE
   echo "  Best for archiving: TAR (compression)" | tee -a $REPORT_FILE
   echo "  Best for synchronization: RSYNC (efficiency)" | tee -a $REPORT_FILE
   echo "  Best for filesystem backup: DUMP (metadata)" | tee -a $REPORT_FILE
   
   # Cleanup
   rm -f "$SOURCE_DIR/new-file.txt"
   
   echo "Comparison completed. Report: $REPORT_FILE"
   
   # chmod +x /usr/local/bin/backup-utility-comparison.sh
2. Create integrated backup solution:
   # vim /usr/local/bin/integrated-backup-solution.sh
   
   #!/bin/bash
   SOURCE=$1
   DESTINATION=$2
   BACKUP_TYPE=${3:-"hybrid"}
   
   if [ $# -lt 2 ]; then
       echo "Usage: $0 <source> <destination> [backup_type]"
       echo "Backup types: tar-only, rsync-only, dump-only, hybrid"
       exit 1
   fi
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/integrated-backup-$TIMESTAMP.log"
   
   echo "=== INTEGRATED BACKUP SOLUTION - $(date) ===" | tee $LOG_FILE
   echo "Source: $SOURCE" | tee -a $LOG_FILE
   echo "Destination: $DESTINATION" | tee -a $LOG_FILE
   echo "Backup type: $BACKUP_TYPE" | tee -a $LOG_FILE
   echo >> $LOG_FILE
   
   case $BACKUP_TYPE in
       "tar-only")
           echo "Performing TAR-only backup..." | tee -a $LOG_FILE
           /usr/local/bin/advanced-tar.sh "$SOURCE" "integrated-backup" "gzip" 2>&1 | tee -a $LOG_FILE
           ;;
       "rsync-only")
           echo "Performing RSYNC-only backup..." | tee -a $LOG_FILE
           /usr/local/bin/rsync-backup.sh "$SOURCE" "$DESTINATION" "mirror" 2>&1 | tee -a $LOG_FILE
           ;;
       "dump-only")
           echo "Performing DUMP-only backup..." | tee -a $LOG_FILE
           if [ -b "$SOURCE" ]; then
               /usr/local/bin/dump-backup.sh "$SOURCE" 0 2>&1 | tee -a $LOG_FILE
           else
               echo "Source must be a block device for dump backup" | tee -a $LOG_FILE
               exit 1
           fi
           ;;
       "hybrid")
           echo "Performing hybrid backup strategy..." | tee -a $LOG_FILE
           
           # Phase 1: RSYNC for quick synchronization
           echo "Phase 1: RSYNC synchronization" | tee -a $LOG_FILE
           mkdir -p "$DESTINATION/rsync-mirror"
           /usr/local/bin/rsync-backup.sh "$SOURCE" "$DESTINATION/rsync-mirror" "mirror" 2>&1 | tee -a $LOG_FILE
           
           # Phase 2: TAR for compressed archive
           echo "Phase 2: TAR compressed archive" | tee -a $LOG_FILE
           mkdir -p "$DESTINATION/tar-archives"
           cd "$DESTINATION/tar-archives"
           /usr/local/bin/advanced-tar.sh "$SOURCE" "hybrid-backup" "gzip" 2>&1 | tee -a $LOG_FILE
           
           # Phase 3: Verification
           echo "Phase 3: Backup verification" | tee -a $LOG_FILE
           LATEST_TAR=$(find "$DESTINATION/tar-archives" -name "*.tar.gz" -type f | head -1)
           if [ -n "$LATEST_TAR" ]; then
               echo "Verifying TAR archive integrity..." | tee -a $LOG_FILE
               if tar -tzf "$LATEST_TAR" >/dev/null 2>&1; then
                   echo "TAR archive verification: PASSED" | tee -a $LOG_FILE
               else
                   echo "TAR archive verification: FAILED" | tee -a $LOG_FILE
               fi
           fi
           
           echo "Verifying RSYNC mirror..." | tee -a $LOG_FILE
           if [ -d "$DESTINATION/rsync-mirror" ]; then
               RSYNC_FILES=$(find "$DESTINATION/rsync-mirror" -type f | wc -l)
               SOURCE_FILES=$(find "$SOURCE" -type f | wc -l)
               echo "Source files: $SOURCE_FILES, Mirror files: $RSYNC_FILES" | tee -a $LOG_FILE
               
               if [ $RSYNC_FILES -eq $SOURCE_FILES ]; then
                   echo "RSYNC mirror verification: PASSED" | tee -a $LOG_FILE
               else
                   echo "RSYNC mirror verification: WARNING (file count mismatch)" | tee -a $LOG_FILE
               fi
           fi
           ;;
       *)
           echo "Invalid backup type: $BACKUP_TYPE" | tee -a $LOG_FILE
           exit 1
           ;;
   esac
   
   echo >> $LOG_FILE
   echo "Integrated backup completed at $(date)" | tee -a $LOG_FILE
   echo "Log file: $LOG_FILE"
   
   # chmod +x /usr/local/bin/integrated-backup-solution.sh

PART E: AUTOMATION AND SCHEDULING
----------------------------------

1. Create backup automation controller:
   # vim /usr/local/bin/backup-automation-controller.sh
   
   #!/bin/bash
   CONFIG_FILE="/etc/backup-utilities.conf"
   
   # Create default configuration
   if [ ! -f $CONFIG_FILE ]; then
       cat > $CONFIG_FILE << 'EOF'
   # Backup Utilities Configuration
   
   # TAR backup settings
   TAR_SOURCE="/home /etc /opt"
   TAR_DESTINATION="/backup/tar-backups"
   TAR_COMPRESSION="gzip"
   TAR_SCHEDULE="daily"
   
   # RSYNC backup settings
   RSYNC_SOURCE="/var/www"
   RSYNC_DESTINATION="/backup/rsync-backups"
   RSYNC_MODE="incremental"
   RSYNC_SCHEDULE="hourly"
   
   # DUMP backup settings
   DUMP_FILESYSTEM="/dev/sda1"
   DUMP_DESTINATION="/backup/dump-backups"
   DUMP_SCHEDULE="weekly"
   
   # Remote backup settings
   REMOTE_HOST="backup-server.example.com"
   REMOTE_PATH="/remote-backups"
   REMOTE_KEY="/root/.ssh/backup_key"
   EOF
   fi
   
   source $CONFIG_FILE
   
   TIMESTAMP=$(date +%Y%m%d_%H%M%S)
   LOG_FILE="/var/log/backup-automation-$TIMESTAMP.log"
   
   echo "=== BACKUP AUTOMATION CONTROLLER - $(date) ===" | tee $LOG_FILE
   
   # Determine what backups to run based on schedule
   CURRENT_HOUR=$(date +%H)
   CURRENT_DOW=$(date +%u)  # 1=Monday, 7=Sunday
   
   # Hourly backups (RSYNC)
   if [ "$RSYNC_SCHEDULE" = "hourly" ]; then
       echo "Running hourly RSYNC backup..." | tee -a $LOG_FILE
       /usr/local/bin/rsync-backup.sh "$RSYNC_SOURCE" "$RSYNC_DESTINATION" "$RSYNC_MODE" 2>&1 | tee -a $LOG_FILE
   fi
   
   # Daily backups (TAR) - run at 2 AM
   if [ "$TAR_SCHEDULE" = "daily" ] && [ $CURRENT_HOUR -eq 2 ]; then
       echo "Running daily TAR backup..." | tee -a $LOG_FILE
       /usr/local/bin/advanced-tar.sh "$TAR_SOURCE" "daily-backup" "$TAR_COMPRESSION" 2>&1 | tee -a $LOG_FILE
   fi
   
   # Weekly backups (DUMP) - run on Sunday at 3 AM
   if [ "$DUMP_SCHEDULE" = "weekly" ] && [ $CURRENT_DOW -eq 7 ] && [ $CURRENT_HOUR -eq 3 ]; then
       echo "Running weekly DUMP backup..." | tee -a $LOG_FILE
       /usr/local/bin/dump-backup.sh "$DUMP_FILESYSTEM" 0 2>&1 | tee -a $LOG_FILE
   fi
   
   echo "Backup automation controller completed" | tee -a $LOG_FILE
   
   # chmod +x /usr/local/bin/backup-automation-controller.sh

2. Create backup monitoring system:
   # vim /usr/local/bin/backup-utilities-monitor.sh
   
   #!/bin/bash
   REPORT_FILE="/var/log/backup-utilities-status-$(date +%Y%m%d).log"
   
   echo "=== BACKUP UTILITIES STATUS REPORT - $(date) ===" > $REPORT_FILE
   echo >> $REPORT_FILE
   
   # Check TAR backups
   echo "TAR BACKUP STATUS:" >> $REPORT_FILE
   TAR_BACKUP_DIR="/backup/tar-backups"
   if [ -d "$TAR_BACKUP_DIR" ]; then
       TAR_COUNT=$(find "$TAR_BACKUP_DIR" -name "*.tar.gz" -type f | wc -l)
       TAR_SIZE=$(du -sh "$TAR_BACKUP_DIR" 2>/dev/null | cut -f1)
       LATEST_TAR=$(find "$TAR_BACKUP_DIR" -name "*.tar.gz" -type f -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)
       
       echo "  Total TAR archives: $TAR_COUNT" >> $REPORT_FILE
       echo "  Total size: $TAR_SIZE" >> $REPORT_FILE
       if [ -n "$LATEST_TAR" ]; then
           echo "  Latest backup: $(basename "$LATEST_TAR")" >> $REPORT_FILE
           echo "  Latest backup date: $(stat -c %y "$LATEST_TAR" | cut -d' ' -f1)" >> $REPORT_FILE
       fi
   else
       echo "  No TAR backup directory found" >> $REPORT_FILE
   fi
   echo >> $REPORT_FILE
   
   # Check RSYNC backups
   echo "RSYNC BACKUP STATUS:" >> $REPORT_FILE
   RSYNC_BACKUP_DIR="/backup/rsync-backups"
   if [ -d "$RSYNC_BACKUP_DIR" ]; then
       RSYNC_SIZE=$(du -sh "$RSYNC_BACKUP_DIR" 2>/dev/null | cut -f1)
       RSYNC_FILES=$(find "$RSYNC_BACKUP_DIR" -type f | wc -l)
       LATEST_RSYNC=$(find "$RSYNC_BACKUP_DIR" -type f -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)
       
       echo "  Total files: $RSYNC_FILES" >> $REPORT_FILE
       echo "  Total size: $RSYNC_SIZE" >> $REPORT_FILE
       if [ -n "$LATEST_RSYNC" ]; then
           echo "  Latest file: $(basename "$LATEST_RSYNC")" >> $REPORT_FILE
           echo "  Latest sync date: $(stat -c %y "$LATEST_RSYNC" | cut -d' ' -f1)" >> $REPORT_FILE
       fi
   else
       echo "  No RSYNC backup directory found" >> $REPORT_FILE
   fi
   echo >> $REPORT_FILE
   
   # Check DUMP backups
   echo "DUMP BACKUP STATUS:" >> $REPORT_FILE
   DUMP_BACKUP_DIR="/backup/dump-backups"
   if [ -d "$DUMP_BACKUP_DIR" ]; then
       DUMP_COUNT=$(find "$DUMP_BACKUP_DIR" -name "*.dump" -type f | wc -l)
       DUMP_SIZE=$(du -sh "$DUMP_BACKUP_DIR" 2>/dev/null | cut -f1)
       LATEST_DUMP=$(find "$DUMP_BACKUP_DIR" -name "*.dump" -type f -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)
       
       echo "  Total dump files: $DUMP_COUNT" >> $REPORT_FILE
       echo "  Total size: $DUMP_SIZE" >> $REPORT_FILE
       if [ -n "$LATEST_DUMP" ]; then
           echo "  Latest dump: $(basename "$LATEST_DUMP")" >> $REPORT_FILE
           echo "  Latest dump date: $(stat -c %y "$LATEST_DUMP" | cut -d' ' -f1)" >> $REPORT_FILE
       fi
   else
       echo "  No DUMP backup directory found" >> $REPORT_FILE
   fi
   echo >> $REPORT_FILE
   
   # Check recent backup activity
   echo "RECENT BACKUP ACTIVITY (Last 24 hours):" >> $REPORT_FILE
   find /var/log -name "*backup*.log" -mtime -1 -exec basename {} \; | sort | uniq >> $REPORT_FILE
   
   echo "Status report generated: $REPORT_FILE"
   
   # chmod +x /usr/local/bin/backup-utilities-monitor.sh

3. Schedule backup utilities:
   # vim /etc/cron.d/backup-utilities
   
   # TAR backup automation
   0 2 * * * root /usr/local/bin/advanced-tar.sh /home daily-home gzip
   0 3 * * 0 root /usr/local/bin/advanced-tar.sh /etc weekly-config gzip
   
   # RSYNC backup automation
   0 */4 * * * root /usr/local/bin/rsync-backup.sh /var/www /backup/rsync-www mirror
   30 */2 * * * root /usr/local/bin/rsync-sync.sh /opt/data /backup/rsync-data push
   
   # DUMP backup automation (weekly full, daily incremental)
   0 1 * * 0 root /usr/local/bin/dump-backup.sh /dev/sda1 0
   0 1 * * 1-6 root /usr/local/bin/incremental-dump.sh /dev/sda1
   
   # Backup monitoring and reporting
   0 6 * * * root /usr/local/bin/backup-utilities-monitor.sh
   0 7 * * * root /usr/local/bin/backup-automation-controller.sh
   
   # Backup comparison (weekly)
   0 4 * * 0 root /usr/local/bin/backup-utility-comparison.sh

PART F: TESTING AND VALIDATION
-------------------------------

1. Test TAR operations:
   # /usr/local/bin/advanced-tar.sh /test-data test-archive gzip
   # /usr/local/bin/incremental-tar.sh /test-data test-incremental
   # ls -la /backup/tar-backups/
   # ls -la /backup/incremental-tar/

2. Test RSYNC operations:
   # mkdir -p /backup/rsync-test
   # /usr/local/bin/rsync-backup.sh /test-data /backup/rsync-test mirror
   # /usr/local/bin/rsync-sync.sh /test-data /backup/rsync-test push
   # ls -la /backup/rsync-test/

3. Test DUMP operations:
   # /usr/local/bin/dump-backup.sh /mnt/test-fs 0
   # mkdir -p /tmp/restore-test
   # /usr/local/bin/dump-restore.sh /backup/dump-backups/dump-level0-*.dump /tmp/restore-test automatic
   # ls -la /tmp/restore-test/

4. Test integrated solution:
   # mkdir -p /backup/integrated-test
   # /usr/local/bin/integrated-backup-solution.sh /test-data /backup/integrated-test hybrid
   # ls -la /backup/integrated-test/

5. Test automation controller:
   # /usr/local/bin/backup-automation-controller.sh
   # /usr/local/bin/backup-utilities-monitor.sh

6. Test utility comparison:
   # /usr/local/bin/backup-utility-comparison.sh

7. Verify backup integrity:
   # tar -tzf /backup/tar-backups/test-archive-*.tar.gz | head -10
   # rsync --dry-run -av /test-data/ /backup/rsync-test/
   # restore -t -f /backup/dump-backups/dump-level0-*.dump | head -10

TROUBLESHOOTING COMMANDS:
-------------------------
# tar --help
# rsync --help
# dump --help
# restore --help
# tail -f /var/log/*backup*.log
# df -h /backup
# mount | grep loop

EXPECTED RESULTS:
-----------------
- Advanced TAR operations with compression and incremental backups
- RSYNC synchronization with multiple modes and remote capabilities
- DUMP filesystem backups with incremental support
- Integrated backup solutions combining multiple utilities
- Automated scheduling and monitoring systems
- Comprehensive backup validation and comparison

VALIDATION CHECKLIST:
---------------------
□ TAR advanced operations working
□ RSYNC backup and sync functional
□ DUMP filesystem backup operational
□ Incremental backups for all utilities
□ Remote backup capabilities tested
□ Integrated backup solution working
□ Automation and scheduling configured
□ Monitoring and reporting active
□ Backup integrity verification successful

CLEANUP:
--------
# rm /etc/cron.d/backup-utilities
# umount /mnt/test-fs
# rm /tmp/test-fs.img
# rm -rf /backup/tar-backups
# rm -rf /backup/rsync-backups
# rm -rf /backup/dump-backups
# rm -rf /backup/comparison
# rm -rf /backup/integrated-test
# rm /usr/local/bin/advanced-tar.sh
# rm /usr/local/bin/incremental-tar.sh
# rm /usr/local/bin/rsync-*.sh
# rm /usr/local/bin/dump-*.sh
# rm /usr/local/bin/integrated-*.sh
# rm /usr/local/bin/backup-*.sh
